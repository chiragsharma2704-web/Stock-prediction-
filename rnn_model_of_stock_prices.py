# -*- coding: utf-8 -*-
"""rnn model of stock prices

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1cV2XgqOXglxfk07FcovmeyjyhhsLVRQf

**Step 1: IMPORT LIBRARIES**
"""

import yfinance as yf

"""**yfinance is a Python library that allows you to:**

‚úÖ Download real stock market data
‚úÖ Access data from Yahoo Finance
‚úÖ Pull data for stocks like Apple, Tesla, Google, etc.
‚úÖ Get prices, volume, dividends, financials, etc.
"""

pip install matplotlib

import pandas as pd
import matplotlib.pyplot as plt

"""**pandas** is a powerful Python library for data manipulation and analysis, especially for structured data (tables). It helps you handle, clean, and analyze data more efficiently.

**matplotlib** is a Python plotting library used for creating visualizations like graphs and charts.

**Step 2: Download Apple stock data**
"""

df = yf.download('AAPL', start='2019-01-01', end='2024-12-31')

df

df.head()

df.tail()

df.shape

df.columns

df.isnull().sum()

df.info()

df.describe()

# Plot the 'Close' price
plt.figure(figsize=(12, 6))
plt.plot(df['Close'])
plt.title('Apple Stock Close Price History')
plt.xlabel('Date')
plt.ylabel('Close Price')
plt.grid(True)
plt.show()

"""**Step 3: Data Preparation for RNN**"""



pip install scikit-learn

import numpy as np
from sklearn.preprocessing import MinMaxScaler
# numpy (np): A library used for handling numerical data and arrays.
# MinMaxScaler: A tool from scikit-learn that scales/normalizes your data between a given range ‚Äî here it's 0 to 1.


close_data = df['Close'].values
# Extracts just the 'Close' column from your DataFrame and converts it into a NumPy array (needed for scaling and RNN training).
close_data = close_data.reshape(-1, 1)
# RNN models expect 2D input for scaling, and here we turn a flat array into a 2D array.


# Normalize the data between 0 and 1
scaler = MinMaxScaler(feature_range=(0, 1))
scaled_data = scaler.fit_transform(close_data)

"""‚úÖ In short: We're preparing your stock prices so that they‚Äôre in the right format and scale for an RNN model to learn from.

**Step 4: Create the training sequences (x_train, y_train)**
"""

sequence_length = 60  # 60 previous days will be used to predict the 61st

x_train = []  #sequences of 60 prices
y_train = []  #the price that comes after each sequence

for i in range(sequence_length, len(scaled_data)):
    x_train.append(scaled_data[i-sequence_length:i, 0])  # last 60 values
    y_train.append(scaled_data[i, 0])                    # 61st value

# Convert to numpy arrays and reshape for RNN input (3d)
x_train, y_train = np.array(x_train), np.array(y_train)
x_train = np.reshape(x_train, (x_train.shape[0], x_train.shape[1], 1))  # (samples, time steps, features)

"""**Step 6: Build and train the RNN model using TensorFlow/Keras**

We‚Äôll use LSTM, a special type of RNN that works well with time-series data like stock prices.

**Long Short-Term Memory**

It‚Äôs a special type of Recurrent Neural Network (RNN) that‚Äôs really good at learning from sequential data, like:

Stock prices over time üìà

Temperature readings üå°Ô∏è

Text, speech, and time series ‚è≥

**Why not just use a regular RNN?**

Regular RNNs forget long-term patterns easily. LSTM solves this with a "memory cell" that can remember important information for long periods.
"""

pip install tensorflow

"""**TensorFlow** is an open-source deep learning framework developed by Google.
It helps you build and train powerful machine learning and deep learning models.
"""

from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import LSTM, Dense

import tensorflow as tf
print(tf.__version__)

# Step 1: Initialize the model
model = Sequential()

# Step 2: Add LSTM Layer
model.add(LSTM(units=50, return_sequences=False, input_shape=(x_train.shape[1], 1)))

# Step 3: Add Dense Output Layer
model.add(Dense(units=1))  # Output: Predicting 1 value (next day price)

# Step 4: Compile the model
model.compile(optimizer='adam', loss='mean_squared_error')

# Step 5: Train the model
history = model.fit(x_train, y_train, epochs=10, batch_size=32)

"""**Step 7: Make Predictions and Visualize Results**

**Preprocess Test Data**
"""

# Use only the 'Close' price
test_close =df['Close'].values.reshape(-1, 1)

# Scale using the same scaler used on training data
scaled_test = scaler.transform(test_close)

# now prediction
predicted_prices = model.predict(x_train)
predicted_prices = scaler.inverse_transform(predicted_prices)  # Convert back to original scale

# Actual prices (from test set, excluding first 60)
real_prices = test_close[60:]

# Plotting
plt.figure(figsize=(10, 6))
plt.plot(real_prices, color='black', label='Actual Apple Stock Price')
plt.plot(predicted_prices, color='green', label='Predicted Apple Stock Price')
plt.title('Apple Stock Price Prediction')
plt.xlabel('Time')
plt.ylabel('Stock Price')
plt.legend()
plt.show()

